<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragment::head}">
  <title>Shop by Category - Lenscraft</title>
</head>

<body class="bg-body">

  <!-- Navbar -->
  <div th:replace="~{fragment::navbar}"></div>

  <!-- Main Content -->
  <section class="py-5" style="margin-top: 60px;">
    <div class="container">

      <!-- Page Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h1 class="display-5 fw-bold font-heading" th:text="${categoryName} ?: 'Shop'">Category</h1>
          <p class="text-secondary lead">Discover premium eyewear that fits your style</p>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="row mb-4">
        <div class="col-lg-6 col-md-8">
          <form th:action="@{/shop/category}" method="get" class="d-flex gap-2">
            <input type="hidden" name="categoryId" th:value="${categoryId}">
            <input class="form-control form-control-lg" type="search" placeholder="Search products..." name="keyword"
              th:value="${keyword}">
            <button class="btn btn-primary-custom px-4" type="submit">
              <i class='bx bx-search'></i> Search
            </button>
          </form>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4 mb-5">
        <div class="col" th:each="product : ${products}">
          <a th:href="@{/shop/productView/{id}/{variableId}(id=${product.productId},variableId=${product.variables[0].variableId})}"
            class="text-decoration-none">
            <div class="card border-0 shadow-sm h-100 product-card">
              <!-- Product Image -->
              <div class="card-img-wrapper position-relative overflow-hidden" style="height: 250px;">
                <img
                  th:src="${#strings.startsWith(product.variables[0].image1, 'http')} ? ${product.variables[0].image1} : @{/productImages/__${product.productId}__/__${product.variables[0].image1}__}"
                  class="card-img-top object-fit-cover h-100 w-100" alt="Product Image"
                  onerror="this.src='/images/default-product.jpg'">

                <!-- Discount Badge -->
                <span th:if="${product.isHavingOffer or product.category.isHavingOffer}"
                  class="badge bg-danger position-absolute top-0 end-0 m-3">
                  <span
                    th:text="${product.isHavingOffer ? product.offer.offerPercentage : product.category.offer.offerPercentage} + '% OFF'">
                    OFF
                  </span>
                </span>
              </div>

              <!-- Product Details -->
              <div class="card-body">
                <p class="text-uppercase text-primary small fw-bold mb-1" th:text="${product.brand.brandName}">Brand</p>
                <h6 class="card-title text-dark fw-bold mb-2" th:text="${product.productName}">Product Name</h6>

                <!-- Price -->
                <div class="d-flex align-items-center gap-2">
                  <h5 class="fw-bold text-dark mb-0" th:text="'₹' + ${product.discountedPrice}">₹0</h5>
                  <small class="text-muted text-decoration-line-through"
                    th:if="${product.isHavingOffer or product.category.isHavingOffer}"
                    th:text="'₹' + ${product.price}">₹0</small>
                </div>

                <!-- Stock Status -->
                <p class="small mt-2 mb-0"
                  th:classappend="${product.stockStatus == 'OUT_OF_STOCK' ? 'text-danger' : 'text-success'}"
                  th:text="${product.stockStatus == 'OUT_OF_STOCK' ? 'Out of Stock' : 'In Stock'}">
                  In Stock
                </p>
              </div>
            </div>
          </a>
        </div>
      </div>

      <!-- Empty State -->
      <div th:if="${#lists.isEmpty(products)}" class="text-center py-5">
        <div class="bg-white rounded-circle shadow-lg d-inline-flex align-items-center justify-content-center mb-4"
          style="width: 150px; height: 150px;">
          <i class='bx bx-package text-secondary opacity-50' style="font-size: 5rem;"></i>
        </div>
        <h3 class="fw-bold mb-2">No Products Found</h3>
        <p class="text-secondary lead mb-4">Try adjusting your search or filters</p>
        <a th:href="@{/shop}" class="btn btn-primary-custom px-5 py-2">Browse All Products</a>
      </div>

      <!-- Pagination -->
      <nav th:if="${totalPages > 1}" aria-label="Product pagination" class="mt-5">
        <ul class="pagination pagination-lg justify-content-center">
          <!-- First Page -->
          <li class="page-item" th:classappend="${pageNo == 1 ? 'disabled' : ''}">
            <a class="page-link"
              th:href="@{/shop/category(pageNo=1,pageSize=12,categoryId=${categoryId},keyword=${keyword})}">
              <i class='bx bx-chevrons-left'></i>
            </a>
          </li>

          <!-- Previous Page -->
          <li class="page-item" th:classappend="${pageNo == 1 ? 'disabled' : ''}">
            <a class="page-link"
              th:href="@{/shop/category(pageNo=${pageNo - 1},pageSize=12,categoryId=${categoryId},keyword=${keyword})}">
              <i class='bx bx-chevron-left'></i> Previous
            </a>
          </li>

          <!-- Page Numbers -->
          <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
            th:classappend="${i == pageNo ? 'active' : ''}">
            <a class="page-link"
              th:href="@{/shop/category(pageNo=${i},pageSize=12,categoryId=${categoryId},keyword=${keyword})}"
              th:text="${i}">1</a>
          </li>

          <!-- Next Page -->
          <li class="page-item" th:classappend="${pageNo == totalPages ? 'disabled' : ''}">
            <a class="page-link"
              th:href="@{/shop/category(pageNo=${pageNo + 1},pageSize=12,categoryId=${categoryId},keyword=${keyword})}">
              Next <i class='bx bx-chevron-right'></i>
            </a>
          </li>

          <!-- Last Page -->
          <li class="page-item" th:classappend="${pageNo == totalPages ? 'disabled' : ''}">
            <a class="page-link"
              th:href="@{/shop/category(pageNo=${totalPages},pageSize=12,categoryId=${categoryId},keyword=${keyword})}">
              <i class='bx bx-chevrons-right'></i>
            </a>
          </li>
        </ul>
      </nav>

    </div>
  </section>

  <!-- Footer -->
  <div th:replace="~{fragment::footer}"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    /* Product Card Hover Effects */
    .product-card {
      transition: all 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15) !important;
    }

    .product-card img {
      transition: transform 0.3s ease;
    }

    .product-card:hover img {
      transform: scale(1.05);
    }

    /* Custom primary button styling */
    .btn-primary-custom {
      background: linear-gradient(135deg, #4F46E5 0%, #4338ca 100%);
      border: none;
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-primary-custom:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
      color: white;
    }

    /* Pagination styling */
    .pagination .page-link {
      border: none;
      color: #4F46E5;
      font-weight: 500;
      margin: 0 4px;
      border-radius: 8px;
    }

    .pagination .page-item.active .page-link {
      background: linear-gradient(135deg, #4F46E5 0%, #4338ca 100%);
      color: white;
    }

    .pagination .page-link:hover {
      background-color: #f3f4f6;
      color: #4F46E5;
    }

    .pagination .page-item.disabled .page-link {
      color: #9ca3af;
    }
  </style>
</body>

</html>